<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>The soft jaguar</title><link>http://thesoftjaguar.com/</link><description></description><atom:link href="http://thesoftjaguar.com/feeds/programming.rss.xml" rel="self"></atom:link><lastBuildDate>Sun, 27 May 2012 18:53:00 +0200</lastBuildDate><item><title>Django regroup Template tag</title><link>http://thesoftjaguar.com/django-regroup-tag.html</link><description>&lt;p&gt;It is a common problem, the case in which we have a huge dictionary, with several fields with repeated data among those dictionary entries. Printing the dictionary, entry by entry, is going to show those repeated field values, and sometimes is not really cool. For a better visualization, we can think that is better to group the entries with the same field value, and we don't know how to do it in the template side.&lt;/p&gt;
&lt;h2&gt;We can do more in the template&lt;/h2&gt;
&lt;p&gt;What is the regroup template tag? It will helps us to loop through a data structure, grouping each entry by a desired field, or maybe we want to group more than once.&lt;/p&gt;
&lt;p&gt;It is a bit tricky to understand this issue so let's put an example. For instance, we have a &lt;code&gt;gps&lt;/code&gt; points list where each of it has &lt;code&gt;latitude&lt;/code&gt;, &lt;code&gt;longitude&lt;/code&gt; and a &lt;code&gt;date&lt;/code&gt;. The date is a &lt;code&gt;datetime&lt;/code&gt; object (let's think about it like &lt;code&gt;year + month +  day&lt;/code&gt;, though it has an hour and the representation of that object is a bit different). Then, we want to organize those points by &lt;code&gt;year&lt;/code&gt;, &lt;code&gt;month&lt;/code&gt; and &lt;code&gt;day&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For instance, we will have a link per &lt;code&gt;day&lt;/code&gt; to another page, showing with detail all the gps points for that specific day. Those days are grouped by months, and the months by years. Both months and years values will redirect to a page filtering the entries.&lt;/p&gt;
&lt;p&gt;A possible approach to this problem would be the following piece of code (arranged in a table), where &lt;code&gt;points&lt;/code&gt; is the variable list provided by the view:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;regroup&lt;/span&gt; &lt;span class="nv"&gt;points&lt;/span&gt; &lt;span class="nv"&gt;by&lt;/span&gt; &lt;span class="nv"&gt;date&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nf"&gt;date&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;Y&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nv"&gt;points_by_year&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="nt"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;entry-content&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;year_points&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;points_by_year&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;caption&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;year_points.grouper&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;
        &lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;caption&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;regroup&lt;/span&gt; &lt;span class="nv"&gt;year_points.list&lt;/span&gt; &lt;span class="nv"&gt;by&lt;/span&gt; &lt;span class="nv"&gt;date&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nf"&gt;date&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;M&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nv"&gt;points_by_month&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
        &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;month_points&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;points_by_month&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
        &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
                &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;month_points.grouper&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
                &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;regroup&lt;/span&gt; &lt;span class="nv"&gt;month_points.list&lt;/span&gt; &lt;span class="nv"&gt;by&lt;/span&gt; &lt;span class="nv"&gt;date&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nf"&gt;date&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;d&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nv"&gt;points_by_day&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
                &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;day_points&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nv"&gt;points_by_day&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
                &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
                    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="nt"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="nv"&gt;nextpage_name&lt;/span&gt; &lt;span class="nv"&gt;year_points.grouper&lt;/span&gt; &lt;span class="nv"&gt;month_points.grouper&lt;/span&gt; &lt;span class="nv"&gt;day_points.grouper&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
                        &lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;day_points.grouper&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;
                    &lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
                &lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
                &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;tr&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;table&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;endfor&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;grouper&lt;/code&gt; variable will show the string of the item that was grouped by, and if it was by year, then it is the year value, because we have filtered it like this:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;regroup&lt;/span&gt; &lt;span class="nv"&gt;points&lt;/span&gt; &lt;span class="nv"&gt;by&lt;/span&gt; &lt;span class="nv"&gt;date&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="nf"&gt;date&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;Y&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nv"&gt;points_by_year&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Using the following piece of code is another way of creating the url for the next page. We need to specify the &lt;code&gt;nextpage_name&lt;/code&gt; in &lt;code&gt;urls.py&lt;/code&gt; and the other two strings are the arguments, so the server will know what page to show.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="cp"&gt;{%&lt;/span&gt; &lt;span class="k"&gt;url&lt;/span&gt; &lt;span class="nv"&gt;nextpage_name&lt;/span&gt; &lt;span class="nv"&gt;year_points.grouper&lt;/span&gt; &lt;span class="nv"&gt;month_points.grouper&lt;/span&gt; &lt;span class="nv"&gt;day_points.grouper&lt;/span&gt; &lt;span class="cp"&gt;%}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Let's see how it looks&lt;/h2&gt;
&lt;p&gt;The result should be something like this:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Regrouping tag overview" src="http://i.imgur.com/fILp6.png" /&gt;&lt;/p&gt;
&lt;p&gt;We don't really need the &lt;code&gt;latitude&lt;/code&gt; and &lt;code&gt;longitude&lt;/code&gt; here, but we need to know that we have X points for a specific day, to show only the involved days. We can create a set of tables where each table is a single year. At the end, it is very simple and there are other solutions, but this is one of them, using the powerful Django regroup template tag. You can browse more information about these tags in the &lt;a href="https://docs.djangoproject.com/en/dev/ref/templates/builtins/?from=olddocs"&gt;Django Documentation&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Other template languages&lt;/h2&gt;
&lt;p&gt;This guide can be applied to other template languages like &lt;code&gt;Jinja2&lt;/code&gt;. There is a great explanation in the &lt;a href="http://jinja.pocoo.org/docs/templates/#groupby"&gt;Jinja2 Documentation&lt;/a&gt;, and is pretty similar to the &lt;code&gt;Django&lt;/code&gt; approach.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Dario Blanco</dc:creator><pubDate>Sun, 27 May 2012 18:53:00 +0200</pubDate><guid>tag:thesoftjaguar.com,2012-05-27:django-regroup-tag.html</guid><category>django</category><category>template</category></item><item><title>Deploying applications with git</title><link>http://thesoftjaguar.com/deploying-applications-with-git.html</link><description>&lt;p&gt;Usually, when we work with an application, especially with web applications, we wonder what is the best way for deploying it, and there are many. It is really important to be comfortable with the way in which we deploy these kind of applications, because the productivity is going to be strongly related to it. Here I explain some &lt;code&gt;git&lt;/code&gt; basics, and how to easily configure it for updating automatically a specific folder (for instance, the web root folder) with the last pushed revision.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Git trunk" src="http://thekevindolan.com/wp-content/uploads/2010/03/git_two1-600x480.jpg" /&gt;&lt;/p&gt;
&lt;h2&gt;Understanding the basics&lt;/h2&gt;
&lt;p&gt;Instead of copypaste the web app local content, or work directly on the server, we will have a distributed version control system like &lt;code&gt;git&lt;/code&gt; to check every local changes (even if we want to work individually), with all the functionality that it provides. Therefore, every time a commit is made, it will not be in the remote server until we do the appropiate push. If you want to know more about &lt;code&gt;git&lt;/code&gt; I recommend the following &lt;a href="http://rogerdudler.github.com/git-guide/&amp;quot;%20target=&amp;quot;_self"&gt;cheatsheet&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For example, if we want to create a local repository (although it doesn't matter, it could be an existing one), we will write the following commands:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$ mkdir webapp&lt;/p&gt;
&lt;p&gt;$ cd webapp&lt;/p&gt;
&lt;p&gt;$ git init&lt;/p&gt;
&lt;p&gt;Initialized empty Git repository in /home/user/webapp/.git/&lt;/p&gt;
&lt;p&gt;$ touch index.html&lt;/p&gt;
&lt;p&gt;$ git add index.html&lt;/p&gt;
&lt;p&gt;$ git commit -m "First commit"&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;The bare and non-bare differentiation&lt;/h2&gt;
&lt;p&gt;Now we have a local &lt;code&gt;git&lt;/code&gt; repository, but... What about the server? I'll try to be as generic as possible regarding the creation of the repository. In addition, I have to highlight the difference in &lt;code&gt;git&lt;/code&gt; between bare repositories and non-bare repositories.&lt;/p&gt;
&lt;p&gt;The bare repositories only have version control files and not work files (tree), also they don't include the special directory .git. Instead, it includes all of its content directly in the root of the bare repository. They are used to have a central repository where the developers can do pull and push: it is a correct way of doing this.&lt;/p&gt;
&lt;p&gt;The non-bare repositories have a special folder &lt;code&gt;.git&lt;/code&gt; which has the control version system information, and the work files: the tree. The local repository which we have created is non-bare.&lt;/p&gt;
&lt;h2&gt;Working in the server&lt;/h2&gt;
&lt;p&gt;Therefore, the idea is to create a bare repository in the server, such that when it receives a push, it will upgrade the web app directory (the folder that we want, for instance, avoiding the change of other management folders, such as the one which contains apache server scripts). This repository will be a mirror from the local one:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$ mkdir webapp.git&lt;/p&gt;
&lt;p&gt;$ cd webapp.git&lt;/p&gt;
&lt;p&gt;$ git init --bare&lt;/p&gt;
&lt;p&gt;Initialized empty Git repository in /home/user/webapp.git/&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;The post-hook creation&lt;/h2&gt;
&lt;p&gt;We need to tell &lt;code&gt;git&lt;/code&gt; to apply the changes in the desired folder, so we must define a post-hook who will apply the changes when the remote repository receives a push, doing a check-out of the last tree in the desired folder. Editing the post-receive file (in the &amp;quot;hook&amp;quot; folder from the bare repository) will do the trick:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GIT_WORK_TREE=/home/user/target_dir git checkout -f&lt;/p&gt;
&lt;p&gt;GIT_WORK_TREE=/home/user/target_dir git reset --hard&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If it was a Django project, we would have defined the project folder (the one with settings.py in it). Otherwise it could have been the &lt;code&gt;/var/www/example_webapp&lt;/code&gt; folder, etc. We have to give execute permissions to the post-receive file (for example with the command &lt;code&gt;chmod +x hooks/post-receive&lt;/code&gt;).&lt;/p&gt;
&lt;h2&gt;Finishing the local set up&lt;/h2&gt;
&lt;p&gt;Back in the local repository, it will be necessary to define the remote repository name (the mirror) and create a master branch in it. For example, we will call the branch &amp;quot;web&amp;quot;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;git remote add web username@domain.com:webapp.git&lt;/p&gt;
&lt;p&gt;git push web +master:refs/heads/master&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We will have the &lt;code&gt;index.html&lt;/code&gt; dummy file in the desired server folder. From now on, changes are made with the following command:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$ git push web&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The small inconvenience of setting up this, is worth the time.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Dario Blanco</dc:creator><pubDate>Wed, 29 Feb 2012 16:33:00 +0100</pubDate><guid>tag:thesoftjaguar.com,2012-02-29:deploying-applications-with-git.html</guid><category>git</category><category>deployment</category><category>bare</category><category>non-bare</category><category>version control</category></item></channel></rss>